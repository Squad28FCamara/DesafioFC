{% extends "layout.njk"%} {% block content %}

<head>
  <title>Reservas</title>
</head>

<body>
  <link rel="stylesheet" href="reserve.css" />

  <div class="info">
    <h1>Reserve uma estação de trabalho</h1>
    <p>
      Pensando em sua segurança, os escritórios da FCamara contam com apenas 40%
      de sua ocupação total.
    </p>
  </div>

  <div class="formzin">
    <section class="pole-and-date">
      <h2>Selecione o polo de negócio e data desejada</h2>
      <span>
        <input type="radio" name="pole" id="sp" value="São Paulo" onclick="able()" checked />
        <label for="">São Paulo</label>
        <input
          type="radio"
          name="pole"
          id="santos"
          value="Santos"
          onclick="disable()"
        /> <label for="">Santos</label>
        <input type="date" name="date" id="date"/>
      </span>
    </section>

<h2 class="that">Escolha a estação e lugar desejado: </h2>

    <div class="bla">

        <section class="station">
        <div class="station">
            <span><input type="radio" name="station" value="E1" id="E1" checked><label for="E1">Estação 01</label></span>
            <img src="estation.png" alt="">
        </div>

        <div class="station">
            <span> <input type="radio" name="station" value="E2" id="E2"><label for="E2">Estação 02</label></span>
            <img src="estation.png" alt="" >
        </div>

         <div class="station">
            <span><input type="radio" name="station"  value="E3" id="E3"><label for="E3">Estação 03</label></span>
            <img src="estation.png" alt="">
        </div>

         <div class="station">
            <span><input type="radio" name="station" value="E4" id="E4"><label for="E4">Estação 04</label></span>
            <img src="estation.png" alt="">
        </div>
    </section>

    <section class="floor-and-seat">
        <select name="seat" id="seat">
          <option value="">Escolha o seu lugar</option>
        <option value="01">01</option>
        <option value="02">02</option>
        <option value="03">03</option>
        <option value="04">04</option>
        <option value="05">05</option>
        <option value="06">06</option>
    </select>

    <select name="floor" id="floor">
        <option value="">Escolha o Andar</option>
        <option value="first">1° Andar</option>
        <option value="second">2° Andar</option>
    </select>
    </section>

    </div>
    <button onclick="submit()">Próximo</button>

  </div>

  <script>
    const floorElement = document.getElementById("floor");
    const seatElement = document.getElementById("seat")
    const dateElement = document.getElementById("date")
    const spElement = document.getElementById("sp")

    const stationElements = []
    for (let x = 1; x < 5; x++) {
      stationElements.push(document.getElementById('E' + x))
    }

    function disable() {
      floorElement.setAttribute("disabled", "true");
      floorElement.options.selected = "first52"
    }

    function able() {
      floorElement.disabled = false;
      floorElement.style.visibility = "visible";
    }

    function getStationNumber() {
      for (let x = 0; x < 4; x++) {
        if (stationElements[x].checked) {
          return x + 1
        }
      }
    }

    function getFormData() {
      const floorNumber = (floorElement.value === 'first') ? 1 : 2
      const stationNumber = getStationNumber()
      const seatNumber = seatElement.value

      return `A${floorNumber}E${stationNumber}C${seatNumber}`
    }

    async function submit() {
      const station = getFormData()
      const date = dateElement.value
      const pole = spElement.checked ? 'São Paulo' : 'Santos'
      const token = localStorage.getItem('token')

      const appointment = await fetch('http://localhost:3333/appointments', {
        method: 'POST',
        body: JSON.stringify({ station, date, pole }),
        headers: {
          "Accept": "application/json, text/plain, */*",
          "Content-Type": "application/json",
          "Authorization": "Bearer " + token
        },

      })
      console.log(appointment)
    }

  </script>
</body>

{% endblock %}
